# Dependencies: In Practice

**Learning objectives:**

- Practical details of working with dependencies
- How to use different types of dependencies in your
    + functions
    + tests
    + examples
    + vignettes and articles

## Confusion about `Imports`

The `DESCRIPTION` file lists the packages that your package needs to work, but does **not** import the package.

Reminder `Imports` makes sure the packages is installed, but does not make functions available to you or your user.

Packages in listed in `Imports` do not need to appear in `NAMESPACE`, but every package in `NAMESPACE` must appear in `Imports` or `Depends`.

## `NAMESPACE` Workflow

The `NAMESPACE` file 

- keeps track of how and when to import functions from another package and export function from your package
- generated from comments in `R/*.R` files
- starts with comment explaining roxygen2 generation
- needs to be regenerated periodically

### General Workflow

1. Add namespace-related tags to roxygen comments in `R/*.R` files.
2. Run `devtools::document()` which updates help topics and regenerates `NAMESPACE` 

## Package is listed in `Imports`

Your package can assume a package listed in `Imports` is installed whenever itself is installed.

### In code below R/

Recommendation: use the syntax `package::function()` to:

- avoid importing `package` to your namespace
- easily identify what functions live outside your package
- eliminate name conflicts

Exceptions:

- An operator can't be called with `::`. ex: magrittr pipe
- A function you use a **lot**: makes code more readable
- A function used in a tight loop: `::` has minor performance penalty on order of 100ns

If making an exception, generate roxygen tag with `usethis::use_import_from()` and place either:

- as close as possible to usage of external function
- in a central location

`usethis::use_import_from()` updates documentation and calls `load_all()`

Importing entire package namespace should be rare and is least recommended.

### `Depends`

Use `Depends`, `LinkingTo`, and `Enhances` for more specialized dependencies.

- Do not use for packages, use `Imports` instead (Chapter 13 spoiler: `Depends` loads and attaches the package whereas `Imports` just loads it)
- Can be used to set a minimum version of R: `R (>= 4.0.0)`
  - If you state a minimum of R, you should have a reason and you should take reasonable measures to test your claim regularly
  
**An R version gotcha**

* `saveRDS()` used version 2 for twenty years
* Version 3 became the default in 2019 with R 3.6.0
* Older packages with version 2 `.rds` files were rebuilt with version 3 and  require R version 3.5.0 or above
* Bundled and source package different!
* All packages listing the original package in `Imports` or even `Suggests` inherit new dependency
* The more dependencies, the more thought to minimum versions

### `LinkingTo`

- Packages listed here rely on C or C++ code in another package

### `Enhances`

- Provide methods for classes defined in another package
- Not recommended

### `Remotes`

- Installs dependencies from outside of CRAN or Bioconductor
  - Nonstandard dependencies are not allowed in CRAN submissions
- Written similar to `Imports`

```
Remotes: hadley/testthat
```

### How to write fields

- Comma-separated
- One package per line
- Alphabetical
- Add with `usethis::use_package(package, type = "Imports")` & `usethis::use_package(package, type = "Suggests")`
- Use `usethis::use_tidy_description()` to put fields in standard order and alphabetize dependencies
- Write minimum versions in parenthesis after package name `dplyr (>= 1.0.0)`. Make sure it is a *minimum* not an *exact* version.




## Meeting Videos

### Cohort 1

`r knitr::include_url("https://www.youtube.com/embed/C_H1oQZD7m8")`


### Cohort 2

`r knitr::include_url("https://www.youtube.com/embed/8PU_KT5IpWg")`


### Cohort 3

`r knitr::include_url("https://www.youtube.com/embed/2-baO_E9p1s")`

<details>
<summary> Meeting chat log </summary>

```
00:05:44	Ryan Metcalf:	https://www.rstudio.com/conference/
00:08:38	Brendan Lam:	https://stackoverflow.com/questions/70097126/how-to-edit-namespace-with-roxygen2-when-creating-r-packages
00:08:51	Brendan Lam:	https://stackoverflow.com/questions/11990589/r-namespace-access-and-match-fun
00:44:59	Rex Parsons:	https://github.com/gentrywhite/DSSP/blob/b3d7f0d10374968a43a634a1ae3f65e9231fceb0/R/plot.R#L43
00:48:01	Rex Parsons:	https://stackoverflow.com/questions/5595512/what-is-the-difference-between-require-and-library
00:58:13	Rex Parsons:	gotta run guys - thanks Brendan and team!
00:58:29	collinberke:	https://stackoverflow.com/questions/64737686/why-library-or-require-should-not-be-used-in-a-r-package
```
</details>


<!--
### Cohort 4

`r knitr::include_url("https://www.youtube.com/embed/VIDURL")`

<details>
<summary> Meeting chat log </summary>

```
LOG
```
</details>
-->


<!--
### Cohort 5

`r knitr::include_url("https://www.youtube.com/embed/VIDURL")`

<details>
<summary> Meeting chat log </summary>

```
LOG
```
</details>
-->
